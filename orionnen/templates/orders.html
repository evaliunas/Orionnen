{% extends "base.html" %}

{% block content %}

    <table id="Orders" class="table table-hover">
        <tr class="header">
          <th style="text-align:center; vertical-align: middle;" width="8%">
              ID
              <input type="text" id="ID" onkeyup="filter_ID()" placeholder="Search ID" style="width: 130px;">
          </th>
          <th style="text-align:center; vertical-align: middle;" width="8%">
              Date
              <div class="dropdown">
                    <button class="btn btn-dark btn-sm dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                        Choose month
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                        <li><a class="dropdown-item" href="{{ url_for('show_orders') }}">All months</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="{{ url_for('show_filtered_orders', month='01') }}">January</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('show_filtered_orders', month='02') }}">February</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('show_filtered_orders', month='03') }}">March</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('show_filtered_orders', month='04') }}">April</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('show_filtered_orders', month='05') }}">May</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('show_filtered_orders', month='06') }}">June</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('show_filtered_orders', month='07') }}">July</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('show_filtered_orders', month='08') }}">August</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('show_filtered_orders', month='09') }}">September</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('show_filtered_orders', month='10') }}">October</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('show_filtered_orders', month='11') }}">November</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('show_filtered_orders', month='12') }}">December</a></li>
                    </ul>
              </div>
          </th>
          <th style="text-align:center; vertical-align: middle;" width="8%">
              Buyer
              <input type="text" id="Buyer" onkeyup="filter_buyer()" placeholder="Search buyer" style="width: 130px;">
          </th>
          <th style="text-align:center; vertical-align: middle;" width="8%">
              SKU
              <input type="text" id="SKU" onkeyup="filter_SKU()" placeholder="Search SKU" style="width: 130px;">
          </th>
          <th style="text-align:center; vertical-align: middle;" width="11%">Revenue</th>
          <th style="text-align:center; vertical-align: middle;" width="11%">Costs</th>
          <th style="text-align:center; vertical-align: middle;" width="11%">Profit</th>
          <th style="text-align:center; vertical-align: middle;" width="11%">
              Status
              <div class="dropdown">
                    <button class="btn btn-dark btn-sm dropdown-toggle" style="width: 180px;" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                        Choose status
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                        <li><a class="dropdown-item" href="{{ url_for('show_orders') }}">All statuses</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="{{ url_for('show_orders_status', status='Ordered', month=month) }}">Ordered</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('show_orders_status', status='Under production', month=month) }}">Under production</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('show_orders_status', status='Shipped to warehouse', month=month) }}">Shipped to warehouse</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('show_orders_status', status='In warehouse', month=month) }}">In warehouse</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('show_orders_status', status='Shipped to buyer', month=month) }}">Shipped to buyer</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('show_orders_status', status='Delivered', month=month) }}">Delivered</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('show_orders_status', status='Waiting for return', month=month) }}">Waiting for return</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('show_orders_status', status='Returned/refunded', month=month) }}">Returned/refunded</a></li>
                    </ul>
                </div>
          </th>
          <th style="text-align:center; vertical-align: middle;" width="20%"> </th>
        </tr>
      <tbody>
        {% for order in orders %}
            <tr>
                <td style="text-align:center; vertical-align:middle">{{ order.order_id }}</td>
                <td style="text-align:center; vertical-align:middle">{{ order.date }}</td>
                <td style="text-align:center; vertical-align:middle">{{ order.buyer }}</td>
                <td style="text-align:center; vertical-align:middle">{{ order.sku }}</td>
                <td style="text-align:center; vertical-align:middle">{{ order.net_revenue }} €</td>
                <td style="text-align:center; vertical-align:middle">{{ order.costs }} €</td>
                <td style="text-align:center; vertical-align:middle">{{ order.profit }} €</td>
                <td style="text-align:center; vertical-align:middle">
                    <div class="dropdown">
                        <button class="btn btn-secondary btn-sm dropdown-toggle" style="width: 180px;" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                            {{ order.status }}
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                            <li><a class="dropdown-item" href="{{ url_for('change_status', order_id=order.order_id, status='Under production') }}">Under production</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('change_status', order_id=order.order_id, status='Shipped to warehouse') }}">Shipped to warehouse</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('change_status', order_id=order.order_id, status='In warehouse') }}">In warehouse</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('change_status', order_id=order.order_id, status='Shipped to buyer') }}">Shipped to buyer</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('change_status', order_id=order.order_id, status='Delivered') }}">Delivered</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('change_status', order_id=order.order_id, status='Waiting for return') }}">Waiting for return</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('change_status', order_id=order.order_id, status='Returned/refunded') }}">Returned/refunded</a></li>
                        </ul>
                    </div>
                </td>
                <td align="center"><a class="btn btn-outline-dark btn-sm" href="{{ url_for('view_order', order_id=order.order_id) }}">View</a> <a class="btn btn-outline-dark btn-sm" href="{{ url_for('edit_order', order_id=order.order_id) }}">Edit</a></td>
            </tr>
        {% endfor %}
      </tbody>
    </table>

    <script>
        function filter_ID() {
            var input, filter, table, tr, td, i, txtValue;
            input = document.getElementById("ID");
            filter = input.value.toUpperCase();
            table = document.getElementById("Orders");
            tr = table.getElementsByTagName("tr");

            for (i = 0; i < tr.length; i++) {
                td = tr[i].getElementsByTagName("td")[0];
                if (td) {
                    txtValue = td.textContent || td.innerText;
                    if (txtValue.toUpperCase().indexOf(filter) > -1) {
                        tr[i].style.display = "";
                    } else {
                    tr[i].style.display = "none";
                    }
                }
            }
        }
        function filter_buyer() {
            var input, filter, table, tr, td, i, txtValue;
            input = document.getElementById("Buyer");
            filter = input.value.toUpperCase();
            table = document.getElementById("Orders");
            tr = table.getElementsByTagName("tr");

            for (i = 0; i < tr.length; i++) {
                td = tr[i].getElementsByTagName("td")[2];
                if (td) {
                    txtValue = td.textContent || td.innerText;
                    if (txtValue.toUpperCase().indexOf(filter) > -1) {
                        tr[i].style.display = "";
                    } else {
                    tr[i].style.display = "none";
                    }
                }
            }
        }
        function filter_SKU() {
            var input, filter, table, tr, td, i, txtValue;
            input = document.getElementById("SKU");
            filter = input.value.toUpperCase();
            table = document.getElementById("Orders");
            tr = table.getElementsByTagName("tr");

            for (i = 0; i < tr.length; i++) {
                td = tr[i].getElementsByTagName("td")[3];
                if (td) {
                    txtValue = td.textContent || td.innerText;
                    if (txtValue.toUpperCase().indexOf(filter) > -1) {
                        tr[i].style.display = "";
                    } else {
                    tr[i].style.display = "none";
                    }
                }
            }
        }
    </script>

{% endblock %}